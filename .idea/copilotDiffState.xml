<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/docs/sql/01-create-update-policy.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/docs/sql/01-create-update-policy.sql" />
              <option name="updatedContent" value="-- ============================================&#10;-- Phase 1: update_policy 테이블 생성&#10;-- 작성일: 2025-11-09&#10;-- 목적: 업데이트 정책 분리 및 단순화&#10;-- ============================================&#10;&#10;-- 1. update_policy 테이블 생성&#10;CREATE TABLE public.update_policy (&#10;    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,&#10;    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),&#10;    &#10;    -- 기본 정보&#10;    app_id TEXT NOT NULL,&#10;    is_active BOOLEAN NOT NULL DEFAULT TRUE,&#10;    &#10;    -- ===== 핵심 필드 (단순화!) =====&#10;    target_version_code INT NOT NULL,        -- 목표 버전 (단일 필드!)&#10;    is_force_update BOOLEAN NOT NULL,        -- 강제 업데이트 여부&#10;    &#10;    -- 부가 정보&#10;    message TEXT,                            -- 업데이트 메시지&#10;    release_notes TEXT,                      -- 릴리즈 노트 (선택적)&#10;    download_url TEXT,                       -- 스토어 링크&#10;    &#10;    CONSTRAINT update_policy_pkey PRIMARY KEY (id),&#10;    -- 앱당 1개의 활성 정책만 허용&#10;    CONSTRAINT update_policy_unique_active &#10;        UNIQUE (app_id, is_active) &#10;        WHERE is_active = true&#10;);&#10;&#10;-- 2. 인덱스 생성&#10;CREATE INDEX idx_update_policy_app_id ON public.update_policy(app_id);&#10;CREATE INDEX idx_update_policy_active ON public.update_policy(is_active);&#10;&#10;-- 3. RLS 정책 설정&#10;ALTER TABLE public.update_policy ENABLE ROW LEVEL SECURITY;&#10;&#10;CREATE POLICY &quot;allow_read_update_policy&quot;&#10;ON public.update_policy&#10;FOR SELECT&#10;USING (true);&#10;&#10;-- 4. 코멘트 추가&#10;COMMENT ON TABLE public.update_policy IS '앱 업데이트 정책 (강제/선택적 업데이트)';&#10;COMMENT ON COLUMN public.update_policy.target_version_code IS '목표 버전 코드 (현재 버전 &lt; 목표 버전이면 업데이트 필요)';&#10;COMMENT ON COLUMN public.update_policy.is_force_update IS '강제 업데이트 여부 (true: 강제, false: 선택적)';&#10;&#10;-- 5. 테스트 데이터 삽입 (PocketChord 앱)&#10;INSERT INTO public.update_policy (&#10;    app_id,&#10;    is_active,&#10;    target_version_code,&#10;    is_force_update,&#10;    message,&#10;    release_notes&#10;) VALUES (&#10;    'com.sweetapps.pocketchord',&#10;    true,&#10;    1,  -- 현재 버전보다 낮게 설정 (업데이트 팝업 안 뜸)&#10;    false,&#10;    '새로운 기능이 추가되었습니다',&#10;    '• 성능 개선\n• 버그 수정'&#10;);&#10;&#10;-- 완료!&#10;SELECT 'update_policy 테이블 생성 완료!' as status;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>