package com.sweetapps.pocketchord.data.supabase.model

import kotlinx.serialization.SerialName
import kotlinx.serialization.Serializable

/**
 * ê³µì§€ì‚¬í•­ ì •ì±… ëª¨ë¸ (ë²„ì „ ê´€ë¦¬)
 *
 * Supabase í…Œì´ë¸” êµ¬ì¡° (notice_policy):
 * ```sql
 * CREATE TABLE public.notice_policy (
 *     id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
 *     created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
 *     app_id TEXT NOT NULL,
 *     is_active BOOLEAN NOT NULL DEFAULT TRUE,
 *     title TEXT,
 *     content TEXT NOT NULL,
 *     notice_version INTEGER NOT NULL DEFAULT 1,
 *     image_url TEXT,
 *     action_url TEXT,
 *     CONSTRAINT notice_policy_pkey PRIMARY KEY (id)
 * )
 * ```
 *
 * ì‚¬ìš© ëª©ì :
 * - ì¼ë°˜ ê³µì§€ì‚¬í•­ (ì´ë²¤íŠ¸, ì‹ ê·œ ê¸°ëŠ¥ ì•ˆë‚´ ë“±)
 * - ì›”ë³„/ì‹œì¦Œë³„ ê³µì§€
 * - ì—…ë°ì´íŠ¸ ì•ˆë‚´ (ì„ íƒì  ì •ë³´)
 *
 * í•µì‹¬ ê¸°ëŠ¥:
 * - notice_version: ë²„ì „ ê´€ë¦¬ë¡œ ëª…ì‹œì  ì œì–´
 * - ì˜¤íƒ€ ìˆ˜ì •: ë²„ì „ ìœ ì§€ â†’ ì¬í‘œì‹œ ì•ˆ ë¨
 * - ìƒˆ ê³µì§€: ë²„ì „ ì¦ê°€ â†’ ëª¨ë‘ì—ê²Œ ì¬í‘œì‹œ
 *
 * ì¶”ì  ë©”ì»¤ë‹ˆì¦˜:
 * - SharedPreferencesì— "notice_v1", "notice_v2" í˜•ì‹ìœ¼ë¡œ ì €ì¥
 * - ë²„ì „ì´ ì¦ê°€í•˜ë©´ ìƒˆ ì‹ë³„ì â†’ ì¬í‘œì‹œë¨
 *
 * ì‚¬ìš© ì˜ˆì‹œ:
 * ```kotlin
 * val notice = noticePolicyRepository.getActiveNotice()
 *
 * notice?.let {
 *     val identifier = "notice_v${it.noticeVersion}"
 *     val prefs = context.getSharedPreferences("notice_prefs", Context.MODE_PRIVATE)
 *     val viewedVersions = prefs.getStringSet("viewed_notices", setOf()) ?: setOf()
 *
 *     if (!viewedVersions.contains(identifier)) {
 *         // ìƒˆ ë²„ì „ â†’ ê³µì§€ í‘œì‹œ
 *         showNoticeDialog(it)
 *     }
 * }
 * ```
 *
 * ìš´ì˜ ì˜ˆì‹œ:
 * ```sql
 * -- ì˜¤íƒ€ ìˆ˜ì • (ë²„ì „ ìœ ì§€)
 * UPDATE notice_policy SET content = 'ìˆ˜ì •ëœ ë‚´ìš©' WHERE app_id = '...';
 * -- notice_version = 1 (ê·¸ëŒ€ë¡œ) â†’ ì´ë¯¸ ë³¸ ì‚¬ìš©ìì—ê²Œ ì•ˆ ëœ¸
 *
 * -- ìƒˆ ê³µì§€ (ë²„ì „ ì¦ê°€)
 * UPDATE notice_policy
 * SET content = '2ì›” ì´ë²¤íŠ¸', notice_version = 2
 * WHERE app_id = '...';
 * -- notice_version = 2 â†’ ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ì¬í‘œì‹œ!
 * ```
 */
@Serializable
data class NoticePolicy(
    /**
     * ì •ì±… ID (ìë™ ìƒì„±)
     */
    @SerialName("id")
    val id: Long? = null,

    /**
     * ìƒì„± ì‹œê°„ (ISO 8601 í˜•ì‹)
     * ì˜ˆ: "2025-11-09T10:30:00Z"
     */
    @SerialName("created_at")
    val createdAt: String? = null,

    /**
     * ì•± ID (íŒ¨í‚¤ì§€ëª…)
     * ì˜ˆ: "com.sweetapps.pocketchord"
     */
    @SerialName("app_id")
    val appId: String,

    /**
     * í™œì„±í™” ì—¬ë¶€
     * - true: ê³µì§€ í™œì„±í™” (íŒì—… í‘œì‹œ ê°€ëŠ¥)
     * - false: ê³µì§€ ë¹„í™œì„±í™” (íŒì—… í‘œì‹œ ì•ˆ í•¨)
     */
    @SerialName("is_active")
    val isActive: Boolean = false,

    /**
     * ê³µì§€ ì œëª© (ì„ íƒì )
     *
     * ì˜ˆì‹œ:
     * - "ğŸ‰ ì‹ ë…„ ì´ë²¤íŠ¸"
     * - "ğŸ’ ë°¸ëŸ°íƒ€ì¸ ë°ì´ íŠ¹ê°€"
     * - "ğŸ“¢ ìƒˆë¡œìš´ ê¸°ëŠ¥ ì•ˆë‚´"
     */
    @SerialName("title")
    val title: String? = null,

    /**
     * ê³µì§€ ë‚´ìš©
     *
     * ì˜ˆì‹œ:
     * - "ìƒˆí•´ ë§ì´ 50% íŠ¹ë³„ í• ì¸!"
     * - "ë‹¤í¬ ëª¨ë“œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.\nì„¤ì •ì—ì„œ í™œì„±í™”í•´ë³´ì„¸ìš”."
     */
    @SerialName("content")
    val content: String,

    // ===== í•µì‹¬: ë²„ì „ ê´€ë¦¬ (ëª…ì‹œì  ì œì–´!) =====

    /**
     * ê³µì§€ ë²„ì „
     *
     * ì‚¬ìš©ë²•:
     * - ì˜¤íƒ€ ìˆ˜ì •: ë²„ì „ ìœ ì§€ (notice_version ê·¸ëŒ€ë¡œ)
     * - ìƒˆ ê³µì§€: ë²„ì „ ì¦ê°€ (notice_version + 1)
     *
     * ì˜ˆì‹œ:
     * - 1ì›” ê³µì§€: notice_version = 1
     * - ì˜¤íƒ€ ìˆ˜ì •: notice_version = 1 (ê·¸ëŒ€ë¡œ) â†’ ì¬í‘œì‹œ ì•ˆ ë¨ âœ…
     * - 2ì›” ê³µì§€: notice_version = 2 (ì¦ê°€) â†’ ëª¨ë‘ì—ê²Œ ì¬í‘œì‹œ âœ…
     *
     * ì¶”ì  ì‹ë³„ì:
     * - "notice_v1", "notice_v2", "notice_v3" ...
     */
    @SerialName("notice_version")
    val noticeVersion: Int = 1
)

