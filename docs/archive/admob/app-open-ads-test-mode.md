# 앱 오프닝 광고 테스트 모드 가이드

## 개요
디버그 빌드에서 앱 오프닝 광고를 쉽게 테스트할 수 있도록 **테스트 모드 스위치**가 추가되었습니다.

---

## 🎯 테스트 모드 기능

### 설정 위치
```
앱 실행
└─ 더보기 탭
   └─ 설정
      └─ 🛠️ 개발 도구 (DEBUG 빌드만 표시)
         └─ 앱 오프닝 광고 테스트 스위치
```

### 동작 방식

#### ON (테스트 모드) 🧪
```
✅ 모든 정책 무시
✅ 첫 실행에서도 광고 시도
✅ 4시간 만료 시간 무시
✅ 백그라운드 복귀 시 항상 광고 시도
✅ 광고가 로드되어 있으면 즉시 표시

→ 테스트 목적으로 광고를 언제든 볼 수 있음!
```

#### OFF (정상 모드) 📱
```
✅ 정책에 맞춰 작동
✅ 첫 실행 시 광고 없음
✅ 4시간 만료 시간 적용
✅ 백그라운드 복귀 시에만 표시

→ 실제 사용자가 경험하는 방식
```

---

## 🧪 테스트 시나리오

### 시나리오 1: 테스트 모드로 즉시 확인

```
1. 설정 → 개발 도구
2. "앱 오프닝 광고 테스트" ON
3. 홈 버튼으로 백그라운드
4. 앱 아이콘으로 복귀
5. 💡 광고 즉시 표시!

※ 첫 실행에서도 광고가 나옵니다
※ 시간 제한 없이 계속 광고가 나옵니다
```

### 시나리오 2: 정상 모드로 실제 경험 확인

```
1. 설정 → 개발 도구
2. "앱 오프닝 광고 테스트" OFF
3. 앱 재실행
4. 첫 실행 → ❌ 광고 없음
5. 백그라운드 복귀 → 💡 광고 표시 (4시간 이내)
```

---

## 📊 개발 도구 전체 구성

디버그 빌드의 설정 화면:

```
🛠️ 개발 도구
├─ 배너 광고 테스트
│  └─ ON: 배너 표시 / OFF: 배너 숨김
├─ 전면 광고 로그
│  └─ ON: 로그 활성화 / OFF: 로그 비활성화
└─ 앱 오프닝 광고 테스트 ⭐ NEW!
   └─ ON: 항상 표시 / OFF: 정책 적용
```

---

## 🔍 로그 확인

### 테스트 모드 ON 시 로그

```bash
adb logcat | findstr "AppOpenAdManager"
```

**출력 예시:**
```
🧪 테스트 모드: 첫 실행이지만 광고를 시도합니다
🧪 테스트 모드: 정책 무시하고 광고 강제 표시
앱 오프닝 광고를 표시합니다
광고가 표시되었습니다
```

### 테스트 모드 OFF 시 로그

```
첫 실행이므로 광고를 표시하지 않습니다
앱이 포그라운드로 왔습니다 (백그라운드에서 복귀)
앱 오프닝 광고를 표시합니다
```

---

## 💡 실전 활용법

### 1. 광고 디자인 확인
```
테스트 모드 ON
→ 백그라운드 복귀만으로 계속 광고 확인 가능
→ 광고 레이아웃, 로딩 속도 등 빠르게 확인
```

### 2. 첫 실행 경험 테스트
```
테스트 모드 OFF
→ 앱 재설치
→ 첫 실행 시 광고 없는지 확인
→ 사용자 경험 검증
```

### 3. 광고 빈도 테스트
```
테스트 모드 OFF
→ 정상 정책으로 광고 빈도 체감
→ 4시간 간격이 적절한지 판단
```

### 4. QA 테스트
```
테스트 모드 ON
→ QA 담당자가 광고 동작 즉시 확인 가능
→ 시간 기다릴 필요 없음
```

---

## ⚙️ 구현 세부사항

### SharedPreferences 키

```kotlin
// 저장소: "ads_prefs"
// 키: "app_open_test_mode"
// 기본값: false

val adPrefs = context.getSharedPreferences("ads_prefs", MODE_PRIVATE)
val isTestMode = adPrefs.getBoolean("app_open_test_mode", false)
```

### 코드 흐름

#### 테스트 모드 ON
```kotlin
showAdIfAvailable() {
    if (isTestMode) {
        // 모든 체크 스킵
        if (광고 로드됨) {
            광고 즉시 표시
        }
    }
}

onStart() {
    if (isTestMode && isFirstLaunch) {
        // 첫 실행도 무시
        광고 시도
    }
}
```

#### 테스트 모드 OFF
```kotlin
showAdIfAvailable() {
    if (!isAdAvailable()) {
        return  // 광고 없거나 만료
    }
    광고 표시
}

onStart() {
    if (isFirstLaunch) {
        return  // 첫 실행 시 광고 없음
    }
    광고 시도
}
```

---

## 🐛 디버깅 팁

### 광고가 계속 안 나올 때

**확인 사항:**
```
1. 개발 도구 → 앱 오프닝 광고 테스트 ON 확인
2. 로그에서 "🧪 테스트 모드" 메시지 확인
3. "광고 로드 성공" 로그 확인
4. 인터넷 연결 확인
```

**해결 방법:**
```
1. 앱 완전 종료 후 재시작
2. 로그에서 광고 로드 상태 확인
3. 광고가 로드된 후 백그라운드 복귀
```

### 테스트 모드인데도 첫 실행에서 광고 안 나올 때

**원인:**
- 광고가 아직 로드되지 않음
- Application 초기화 시점에 광고 로드 시작

**해결:**
```
1. 앱 시작
2. 5초 정도 대기 (광고 로드 시간)
3. 백그라운드 복귀
4. 광고 확인
```

---

## 📱 릴리즈 빌드

### 자동 비활성화

```
릴리즈 빌드
└─ if (BuildConfig.DEBUG) { ... }
   └─ 개발 도구 섹션 전체 숨김
      └─ 앱 오프닝 광고 테스트 스위치 없음
```

**결과:**
- ✅ 릴리즈에서는 테스트 모드 불가능
- ✅ 항상 정상 정책으로 작동
- ✅ 사용자가 설정 변경 불가능

---

## 🎯 권장 워크플로우

### 개발 중
```
1. 테스트 모드 ON
2. 광고 디자인/동작 빠르게 확인
3. 이슈 발견 시 즉시 수정
4. 백그라운드 복귀로 반복 테스트
```

### QA 전달 전
```
1. 테스트 모드 OFF
2. 정상 사용자 경험 확인
3. 첫 실행, 백그라운드 복귀 시나리오 검증
4. 4시간 정책 확인 (필요 시 시간 조정)
```

### QA 단계
```
1. QA 담당자에게 테스트 모드 안내
2. 기능 테스트: 테스트 모드 ON
3. 사용자 경험 테스트: 테스트 모드 OFF
4. 양쪽 시나리오 모두 검증
```

### 배포 전
```
1. 릴리즈 빌드 생성
2. 개발 도구 섹션 숨김 확인
3. 정상 정책으로만 작동 확인
4. 최종 승인
```

---

## 💡 추가 아이디어

### 광고 강제 표시 버튼 (향후 추가 가능)

```kotlin
// 개발 도구에 버튼 추가
Button(onClick = {
    // 현재 Activity에서 강제로 광고 표시
    (application as PocketChordApplication)
        .showAppOpenAdNow(currentActivity)
}) {
    Text("광고 강제 표시")
}
```

### 광고 통계 표시 (향후 추가 가능)

```kotlin
// 개발 도구에 통계 표시
Text("광고 표시 횟수: $adShowCount")
Text("마지막 광고 시간: $lastAdTime")
Text("광고 로드 상태: $adLoadStatus")
```

---

## ✅ 체크리스트

### 개발자

- [x] 테스트 모드 스위치 추가
- [x] ON/OFF 동작 구현
- [x] 첫 실행 정책 처리
- [x] 4시간 만료 정책 처리
- [x] 로그 메시지 추가
- [x] 디버그 빌드에만 표시
- [x] 릴리즈 빌드에서 자동 숨김

### QA

- [ ] 테스트 모드 ON → 광고 즉시 표시 확인
- [ ] 테스트 모드 OFF → 정상 정책 확인
- [ ] 첫 실행 시나리오 확인
- [ ] 백그라운드 복귀 시나리오 확인
- [ ] 릴리즈 빌드에서 개발 도구 숨김 확인

---

## 📚 관련 문서

- **`app-open-ads-guide.md`** - 앱 오프닝 광고 전체 가이드
- **`app-open-ads-summary.md`** - 앱 오프닝 광고 요약
- **`interstitial-ads-final.md`** - 전면광고 가이드

---

**앱 오프닝 광고를 더 쉽게 테스트할 수 있습니다!** 🎉

*추가일: 2025년 11월 2일*
*버전: 1.1*

