# PocketChord Supabase í†µí•© ì™„ì „ ê°€ì´ë“œ

> PocketChord ì•±ì—ì„œ Supabaseë¥¼ í™œìš©í•˜ì—¬ ê³µì§€ì‚¬í•­, ì•± ì—…ë°ì´íŠ¸ ì •ë³´, ë°°ë„ˆ ì„¤ì • ë“± ì„œë²„ ê´€ë¦¬ ì½˜í…ì¸ ë¥¼ êµ¬í˜„í•˜ëŠ” ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

**ì‘ì„±ì¼**: 2025-01-05  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-05

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [Supabase í”„ë¡œì íŠ¸ ì„¤ì •](#1ë‹¨ê³„-supabase-í”„ë¡œì íŠ¸-ì„¤ì •)
3. [Android í”„ë¡œì íŠ¸ ì„¤ì •](#2ë‹¨ê³„-android-í”„ë¡œì íŠ¸-ì„¤ì •)
4. [Kotlin ë°ì´í„° ëª¨ë¸](#3ë‹¨ê³„-kotlin-ë°ì´í„°-ëª¨ë¸)
5. [Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”](#4ë‹¨ê³„-supabase-í´ë¼ì´ì–¸íŠ¸-ì´ˆê¸°í™”)
6. [ë°ì´í„° ì¡°íšŒ ë° UI í‘œì‹œ](#5ë‹¨ê³„-ë°ì´í„°-ì¡°íšŒ-ë°-ui-í‘œì‹œ)
7. [Repository íŒ¨í„´ êµ¬í˜„](#6ë‹¨ê³„-repository-íŒ¨í„´-êµ¬í˜„)
8. [ìºì‹± ì „ëµ](#7ë‹¨ê³„-ìºì‹±-ì „ëµ)
9. [ê´€ë¦¬ì ì‘ì—… íë¦„](#ê´€ë¦¬ì-ì‘ì—…-íë¦„)
10. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
11. [FAQ](#faq)

---

## ê°œìš”

### ğŸ“Š ì‹¤ì œ ìŠ¤í‚¤ë§ˆ ì ìš© ì™„ë£Œ âœ…

**ê·€í•˜ì˜ ì‹¤ì œ Supabase `announcements` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆê°€ ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤!**

```sql
CREATE TABLE public.announcements (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    app_id TEXT NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    CONSTRAINT announcements_pkey PRIMARY KEY (id)
)
```

**ì ìš© ìœ„ì¹˜**: 
- `app/src/.../supabase/Announcement.kt` - ê³µì§€ì‚¬í•­ ëª¨ë¸
- `app/src/.../supabase/AppVersion.kt` - ì•± ë²„ì „ ì •ë³´ ëª¨ë¸

### ğŸ¯ Supabase ì‚¬ìš© ëª©ì 

#### âœ… Supabaseë¡œ ê´€ë¦¬í•  ê²ƒ
- **ê³µì§€ì‚¬í•­** (Announcements): ì•± ë‚´ íŒì—…, ë°°ë„ˆ, ë‰´ìŠ¤ í”¼ë“œ
- **ì•± ë²„ì „ ì •ë³´**: ì—…ë°ì´íŠ¸ ì•Œë¦¼, ê°•ì œ ì—…ë°ì´íŠ¸ ì œì–´
- **ì´ë²¤íŠ¸ ì •ë³´**: í•œì • ì´ë²¤íŠ¸, í”„ë¡œëª¨ì…˜

#### âŒ Supabaseë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì„ ê²ƒ
- **ì½”ë“œ ë°ì´í„°** (Chords, Variants): ë¡œì»¬ Room DB ì‚¬ìš©
- **ì‚¬ìš©ì ì„¤ì •**: SharedPreferences/DataStore ì‚¬ìš©
- **ì„ì‹œ ìºì‹œ**: ë¡œì»¬ ë©”ëª¨ë¦¬/íŒŒì¼ ì‹œìŠ¤í…œ ì‚¬ìš©

### ğŸ”‘ í•µì‹¬ ê°œë…: ìŠ¤í‚¤ë§ˆ ë§¤í•‘

Supabase í…Œì´ë¸” êµ¬ì¡°ë¥¼ Kotlin ë°ì´í„° í´ë˜ìŠ¤ë¡œ "ë³µì‚¬"í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase (PostgreSQL)      â”‚
â”‚                             â”‚
â”‚  CREATE TABLE announcements â”‚
â”‚  â”œâ”€â”€ id (bigint)            â”‚
â”‚  â”œâ”€â”€ created_at (timestamp) â”‚
â”‚  â”œâ”€â”€ app_id (text)          â”‚
â”‚  â”œâ”€â”€ title (text)           â”‚
â”‚  â”œâ”€â”€ content (text)         â”‚
â”‚  â””â”€â”€ is_active (boolean)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ ë³€í™˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Kotlin (Android)           â”‚
â”‚                             â”‚
â”‚  @Serializable              â”‚
â”‚  data class Announcement(   â”‚
â”‚    val id: Long?,           â”‚
â”‚    @SerialName("created_at")â”‚
â”‚    val createdAt: String?,  â”‚
â”‚    @SerialName("app_id")    â”‚
â”‚    val appId: String,       â”‚
â”‚    val title: String,       â”‚
â”‚    val content: String,     â”‚
â”‚    @SerialName("is_active") â”‚
â”‚    val isActive: Boolean    â”‚
â”‚  )                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“‹ í•„ë“œ ë§¤í•‘ ìƒì„¸

| Supabase ì»¬ëŸ¼ | íƒ€ì… | Kotlin í•„ë“œ | íƒ€ì… | ë¹„ê³  |
|--------------|------|-------------|------|------|
| `id` | BIGINT | `id` | `Long?` | ìë™ ìƒì„±, nullable |
| `created_at` | TIMESTAMP | `createdAt` | `String?` | ISO 8601 í˜•ì‹ |
| `app_id` | TEXT | `appId` | `String` | ê¸°ë³¸ê°’: "com.sweetapps.pocketchord" |
| `title` | TEXT | `title` | `String` | í•„ìˆ˜ |
| `content` | TEXT | `content` | `String` | í•„ìˆ˜ |
| `is_active` | BOOLEAN | `isActive` | `Boolean` | ê¸°ë³¸ê°’: true |

**â­ ì¤‘ìš”**: `@SerialName`ì€ snake_case â†” camelCase ìë™ ë³€í™˜ì„ ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤!

---

## 1ë‹¨ê³„: Supabase í”„ë¡œì íŠ¸ ì„¤ì •

### 1.1 í”„ë¡œì íŠ¸ ìƒì„±

1. https://supabase.com ì ‘ì†
2. **New Project** í´ë¦­
3. í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥:
   - Name: `PocketChord`
   - Database Password: ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ì €ì¥ í•„ìˆ˜!)
   - Region: `Northeast Asia (Seoul)`
4. **Create new project** í´ë¦­ (2-3ë¶„ ì†Œìš”)

### 1.2 í…Œì´ë¸” ìƒì„±

SQL Editorì—ì„œ ë‹¤ìŒ ì¿¼ë¦¬ ì‹¤í–‰:

#### ê³µì§€ì‚¬í•­ í…Œì´ë¸”
```sql
-- í…Œì´ë¸” ìƒì„± (ì´ë¯¸ ìƒì„±ë˜ì–´ ìˆë‹¤ë©´ ìƒëµ)
CREATE TABLE public.announcements (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    app_id TEXT NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    CONSTRAINT announcements_pkey PRIMARY KEY (id)
) TABLESPACE pg_default;

-- ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX idx_announcements_active ON announcements(is_active);
CREATE INDEX idx_announcements_app_id ON announcements(app_id, is_active);

-- Row Level Security (RLS) í™œì„±í™”
ALTER TABLE announcements ENABLE ROW LEVEL SECURITY;

-- ëª¨ë“  ì‚¬ìš©ìê°€ í™œì„±í™”ëœ ê³µì§€ì‚¬í•­ì„ ì½ì„ ìˆ˜ ìˆë„ë¡ ì •ì±… ì„¤ì •
CREATE POLICY "Anyone can read active announcements"
ON announcements FOR SELECT
USING (is_active = true);
```

#### ì•± ë²„ì „ ì •ë³´ í…Œì´ë¸”
```sql
CREATE TABLE app_versions (
    id BIGSERIAL PRIMARY KEY,
    version_code INTEGER NOT NULL UNIQUE,
    version_name TEXT NOT NULL,
    min_required_version INTEGER NOT NULL,
    release_notes TEXT NOT NULL,
    is_force_update BOOLEAN DEFAULT false,
    download_url TEXT,
    released_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE INDEX idx_app_versions_code ON app_versions(version_code DESC);

ALTER TABLE app_versions ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can read app versions"
ON app_versions FOR SELECT
USING (true);
```


### 1.3 API í‚¤ í™•ì¸

1. **Settings** â†’ **API** ì´ë™
2. ë‹¤ìŒ ì •ë³´ ë³µì‚¬ (ë©”ëª¨ì¥ì— ì €ì¥):
   - **Project URL**: `https://xxx.supabase.co`
   - **anon/public key**: `eyJxxx...`

âš ï¸ **ì¤‘ìš”**: `service_role` í‚¤ëŠ” ì ˆëŒ€ ì•±ì— ë„£ì§€ ë§ˆì„¸ìš”!

### 1.4 í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ (ì„ íƒ)

```sql
-- í…ŒìŠ¤íŠ¸ ê³µì§€ì‚¬í•­ ì¶”ê°€
INSERT INTO announcements (app_id, title, content, is_active)
VALUES 
  ('com.sweetapps.pocketchord', 'í™˜ì˜í•©ë‹ˆë‹¤!', 'PocketChordì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.', true),
  ('com.sweetapps.pocketchord', 'ìƒˆë¡œìš´ ê¸°ëŠ¥', 'ì´ì œ ë” ë§ì€ ì½”ë“œë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', true);

-- í…ŒìŠ¤íŠ¸ ë²„ì „ ì •ë³´ ì¶”ê°€
INSERT INTO app_versions (version_code, version_name, min_required_version, release_notes)
VALUES (1, '1.0.0', 1, 'ìµœì´ˆ ë¦´ë¦¬ì¦ˆ');

-- í…ŒìŠ¤íŠ¸ ë²„ì „ ì •ë³´ ì¶”ê°€
INSERT INTO app_versions (version_code, version_name, min_required_version, release_notes)
VALUES (1, '1.0.0', 1, 'ìµœì´ˆ ë¦´ë¦¬ì¦ˆ');
```

---

## 2ë‹¨ê³„: Android í”„ë¡œì íŠ¸ ì„¤ì •

### 2.1 ì˜ì¡´ì„± ì¶”ê°€

#### `gradle/libs.versions.toml` ìˆ˜ì •

```toml
[versions]
kotlin = "2.2.21"  # âš ï¸ ì¤‘ìš”: Supabase 3.x í˜¸í™˜
ktor = "3.3.1"
supabase = "3.2.6"

[libraries]
# ...existing libraries...
supabase-bom = { group = "io.github.jan-tennert.supabase", name = "bom", version.ref = "supabase" }
supabase-postgrest = { group = "io.github.jan-tennert.supabase", name = "postgrest-kt", version.ref = "supabase" }
ktor-client-android = { group = "io.ktor", name = "ktor-client-android", version.ref = "ktor" }

[plugins]
# ...existing plugins...
kotlin-serialization = { id = "org.jetbrains.kotlin.plugin.serialization", version.ref = "kotlin" }
```

#### `app/build.gradle.kts` ìˆ˜ì •

```kotlin
plugins {
    alias(libs.plugins.android.application)
    alias(libs.plugins.kotlin.android)
    alias(libs.plugins.kotlin.compose)
    alias(libs.plugins.kotlin.serialization)  // âœ… ì¶”ê°€
}

dependencies {
    // ...existing dependencies...
    
    // Supabase
    implementation(platform(libs.supabase.bom))
    implementation(libs.supabase.postgrest)
    implementation(libs.ktor.client.android)
}
```

### 2.2 ì¸í„°ë„· ê¶Œí•œ ì¶”ê°€

`app/src/main/AndroidManifest.xml`:

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- âœ… ì¶”ê°€ -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    
    <application ...>
        ...
    </application>
</manifest>
```

### 2.3 Gradle Sync

Android Studioì—ì„œ **Sync Now** í´ë¦­ ë˜ëŠ”:
```
./gradlew clean build
```

---

### 3.1 ëª¨ë¸ íŒŒì¼ êµ¬ì¡°

Supabase ëª¨ë¸ì€ ê´€ì‹¬ì‚¬ë³„ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```
// Announcement.kt
app/src/main/java/com/sweetapps/pocketchord/data/supabase/
â”œâ”€â”€ Announcement.kt      - ê³µì§€ì‚¬í•­ ëª¨ë¸
â””â”€â”€ UpdateInfo.kt        - ì•± ë²„ì „ ì •ë³´ & ë°°ë„ˆ ì„¤ì • ëª¨ë¸
```

### 3.2 ê³µì§€ì‚¬í•­ ëª¨ë¸ (Announcement.kt)


```kotlin
package com.sweetapps.pocketchord.data.supabase

import kotlinx.serialization.SerialName
import kotlinx.serialization.Serializable

/**
    val createdAt: String? = null,
 * 
 * ì‹¤ì œ Supabase í…Œì´ë¸” êµ¬ì¡°ì— ë§ì¶° ì‘ì„±
 */
@Serializable
data class Announcement(
    @SerialName("id")
    val id: Long? = null,

    @SerialName("created_at")
    val createdAt: String? = null,  // ISO 8601 format

    @SerialName("app_id")
    val appId: String = "com.sweetapps.pocketchord",
```

### 3.3 ì•± ë²„ì „ ì •ë³´ ëª¨ë¸ (UpdateInfo.kt)

```kotlin
// UpdateInfo.kt
package com.sweetapps.pocketchord.data.supabase

import kotlinx.serialization.SerialName
import kotlinx.serialization.Serializable

    @SerialName("title")
    val title: String,

    @SerialName("content")
    val content: String,

    @SerialName("is_active")
    val isActive: Boolean = true
)

/**
 * ì•± ë²„ì „ ì •ë³´ ëª¨ë¸
 */
@Serializable
data class AppVersion(
    @SerialName("id")
    val id: Long? = null,

    @SerialName("version_code")
    val versionCode: Int,

    @SerialName("version_name")
    val versionName: String,

    @SerialName("min_required_version")
    val minRequiredVersion: Int,

    @SerialName("release_notes")
    val releaseNotes: String,

    @SerialName("is_force_update")
    val isForceUpdate: Boolean = false,

    @SerialName("download_url")
    val downloadUrl: String? = null,

    @SerialName("released_at")
    val releasedAt: String? = null
)
```

### 3.3 ì£¼ìš” ì–´ë…¸í…Œì´ì…˜ ì„¤ëª…

- **`@Serializable`**: JSON â†” Kotlin ê°ì²´ ìë™ ë³€í™˜
- **`@SerialName`**: DBì˜ snake_caseì™€ Kotlinì˜ camelCase ìë™ ë§¤í•‘
  - DB: `is_active` â†’ Kotlin: `isActive`
  - DB: `created_at` â†’ Kotlin: `createdAt`

---

## 4ë‹¨ê³„: Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”

### 4.1 ì „ì—­ í´ë¼ì´ì–¸íŠ¸ ìƒì„±

`MainActivity.kt` íŒŒì¼ ìƒë‹¨ (í´ë˜ìŠ¤ ë°”ê¹¥):

```kotlin
package com.sweetapps.pocketchord

// ...existing imports...

import io.github.jan.supabase.createSupabaseClient
import io.github.jan.supabase.postgrest.Postgrest
import io.github.jan.supabase.postgrest.from

// âœ… ì „ì—­ Supabase í´ë¼ì´ì–¸íŠ¸
val supabase = createSupabaseClient(
    supabaseUrl = "https://bajurdtglfaiqilnpamt.supabase.co",
    supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."  // anon key
) {
    install(Postgrest)
}

class MainActivity : ComponentActivity() {
    // ...
}
```

### 4.2 ë³´ì•ˆ ê°•í™” (ìš´ì˜ ë°°í¬ ì‹œ ê¶Œì¥)

#### `local.properties` ì¶”ê°€
```properties
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=eyJxxx...
```

#### `app/build.gradle.kts` ìˆ˜ì •
```kotlin
android {
    // ...
    defaultConfig {
        // ...
        buildConfigField("String", "SUPABASE_URL", "\"${project.findProperty("SUPABASE_URL")}\"")
        buildConfigField("String", "SUPABASE_ANON_KEY", "\"${project.findProperty("SUPABASE_ANON_KEY")}\"")
    }
}
```

#### í´ë¼ì´ì–¸íŠ¸ ìƒì„± ìˆ˜ì •
```kotlin
val supabase = createSupabaseClient(
    supabaseUrl = BuildConfig.SUPABASE_URL,
    supabaseKey = BuildConfig.SUPABASE_ANON_KEY
) {
    install(Postgrest)
}
```

---

## 5ë‹¨ê³„: ë°ì´í„° ì¡°íšŒ ë° UI í‘œì‹œ

### ğŸ’¡ ì¤‘ìš”: app_id í•„í„°ë§

**ë°˜ë“œì‹œ** `app_id`ë¡œ í•„í„°ë§í•´ì•¼ í•©ë‹ˆë‹¤! í•˜ë‚˜ì˜ Supabase í”„ë¡œì íŠ¸ì—ì„œ ì—¬ëŸ¬ ì•±ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ:

```kotlin
// âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ
supabase.from("announcements")
    .select()
    .eq("app_id", "com.sweetapps.pocketchord")     // â­ í•„ìˆ˜!
    .eq("is_active", true)
    .decodeList<Announcement>()

// âŒ ì˜ëª»ëœ ì½”ë“œ (ë‹¤ë¥¸ ì•± ë°ì´í„°ê¹Œì§€ ì„ì—¬ì„œ ì¡°íšŒë¨)
supabase.from("announcements")
    .select()
    .eq("is_active", true)            // app_id í•„í„° ëˆ„ë½!
    .decodeList<Announcement>()
```

### 5.1 ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ UI

`MainActivity.kt`ì— ì¶”ê°€:

```kotlin
import com.sweetapps.pocketchord.data.supabase.Announcement
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

@Composable
fun AnnouncementsList() {
    var items by remember { mutableStateOf<List<Announcement>>(emptyList()) }
    var error by remember { mutableStateOf<String?>(null) }
    var isLoading by remember { mutableStateOf(true) }
    
    LaunchedEffect(Unit) {
        try {
            val result = withContext(Dispatchers.IO) {
                supabase.from("announcements")
                    .select()
                    .eq("app_id", "pocketchord")  // â­ app_id í•„í„°ë§!
                    .eq("is_active", true)
                    .order("created_at", descending = true)
                    .decodeList<Announcement>()
            }
            items = result
        } catch (e: Exception) {
            error = e.message ?: "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"
            android.util.Log.e("AnnouncementsList", "Error loading data", e)
        } finally {
            isLoading = false
        }
    }
    
    when {
        isLoading -> Box(
            modifier = Modifier.fillMaxSize(),
            contentAlignment = Alignment.Center
        ) {
            CircularProgressIndicator()
        }
        
        error != null -> Column(
            modifier = Modifier.fillMaxSize().padding(16.dp)
        ) {
            Text("âŒ ì˜¤ë¥˜ ë°œìƒ", fontWeight = FontWeight.Bold, fontSize = 18.sp)
            Spacer(Modifier.height(8.dp))
            Text(error ?: "", fontSize = 14.sp)
        }
        
        items.isEmpty() -> Box(
            modifier = Modifier.fillMaxSize(),
            contentAlignment = Alignment.Center
        ) {
            Text("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤", fontSize = 16.sp)
        }
        
        else -> LazyColumn(Modifier.fillMaxSize()) {
            items(items, key = { it.id ?: 0 }) { item ->
                Card(
                    modifier = Modifier
                        .fillMaxWidth()
                        .padding(horizontal = 16.dp, vertical = 8.dp)
                ) {
                    Column(Modifier.padding(16.dp)) {
                        Text(item.title, fontWeight = FontWeight.Bold, fontSize = 16.sp)
                        Spacer(Modifier.height(4.dp))
                        Text(item.content, fontSize = 14.sp)
                    }
                }
            }
        }
    }
}
```

### 5.2 í…ŒìŠ¤íŠ¸

NavHostì—ì„œ ì„ì‹œë¡œ í˜¸ì¶œ:

```kotlin
NavHost(...) {
    composable("home") { AnnouncementsList() }  // í…ŒìŠ¤íŠ¸ìš©
    // ...
}
```

---

## 6ë‹¨ê³„: Repository íŒ¨í„´ êµ¬í˜„

### 6.1 Repository ìƒì„±

`app/src/main/java/com/sweetapps/pocketchord/data/supabase/SupabaseRepository.kt`:

```kotlin
package com.sweetapps.pocketchord.data.supabase

import io.github.jan.supabase.SupabaseClient
import io.github.jan.supabase.postgrest.from

class SupabaseRepository(private val supabase: SupabaseClient) {
    
    /**
     * í™œì„±í™”ëœ ê³µì§€ì‚¬í•­ ì¡°íšŒ
     * app_idë¡œ í•„í„°ë§í•˜ì—¬ PocketChord ì•± ì „ìš© ê³µì§€ì‚¬í•­ë§Œ ê°€ì ¸ì˜´
     */
    suspend fun getActiveAnnouncements(): Result<List<Announcement>> = runCatching {
        supabase.from("announcements")
            .select()
            .eq("app_id", "com.sweetapps.pocketchord")
            .eq("is_active", true)
            .order("created_at", descending = true)
            .decodeList()
    }
    
    /**
     * ìµœì‹  ì•± ë²„ì „ í™•ì¸
     */
    suspend fun getLatestVersion(): Result<AppVersion?> = runCatching {
        supabase.from("app_versions")
            .select()
            .order("version_code", descending = true)
            .limit(1)
            .decodeSingleOrNull()
    }
    
    /**
     * ì—…ë°ì´íŠ¸ í•„ìš” ì—¬ë¶€ í™•ì¸
     */
    suspend fun checkForUpdate(currentVersionCode: Int): Result<AppVersion?> = runCatching {
        supabase.from("app_versions")
            .select()
            .gte("version_code", currentVersionCode + 1)
            .order("version_code", descending = true)
            .limit(1)
            .decodeSingleOrNull()
    }
}
```

### 6.2 ì‚¬ìš© ì˜ˆì‹œ

```kotlin
class MainActivity : ComponentActivity() {
    private val repository = SupabaseRepository(supabase)
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        lifecycleScope.launch {
            // ê³µì§€ì‚¬í•­ í™•ì¸
            repository.getActiveAnnouncements().onSuccess { announcements ->
                announcements.firstOrNull()?.let { showAnnouncementDialog(it) }
            }
            
            // ì—…ë°ì´íŠ¸ í™•ì¸
            repository.checkForUpdate(BuildConfig.VERSION_CODE).onSuccess { update ->
                if (update != null) {
                    // update.isForce ê°’ì— ë”°ë¼ ê°•ì œ/ì„ íƒì  ì—…ë°ì´íŠ¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
                    showUpdateDialog(update)
                }
            }
        }
    }
}
```

---

## 7ë‹¨ê³„: ìºì‹± ì „ëµ

### 7.1 SharedPreferences ìºì‹±

```kotlin
class CachedSupabaseRepository(
    private val supabase: SupabaseClient,
    private val prefs: SharedPreferences
) {
    private val gson = Gson()
    private val cacheMaxAge = 5 * 60 * 1000L  // 5ë¶„
    
    suspend fun getAnnouncements(): List<Announcement> {
        val cacheKey = "announcements_cache"
        val cacheTimeKey = "announcements_cache_time"
        
        // ìºì‹œ í™•ì¸
        val cacheTime = prefs.getLong(cacheTimeKey, 0)
        if (System.currentTimeMillis() - cacheTime < cacheMaxAge) {
            prefs.getString(cacheKey, null)?.let { json ->
                return gson.fromJson(json, Array<Announcement>::class.java).toList()
            }
        }
        
        // ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ê¸°
        val fresh = supabase.from("announcements")
            .select()
            .eq("app_id", "pocketchord")
            .eq("is_active", true)
            .order("created_at", descending = true)
            .decodeList<Announcement>()
        
        // ìºì‹œ ì €ì¥
        prefs.edit()
            .putString(cacheKey, gson.toJson(fresh))
            .putLong(cacheTimeKey, System.currentTimeMillis())
            .apply()
        
        return fresh
    }
}
```

---

## ê´€ë¦¬ì ì‘ì—… íë¦„

### ê³µì§€ì‚¬í•­ ì¶”ê°€í•˜ê¸°

1. Supabase Dashboard ì ‘ì†
2. **Table Editor** â†’ `announcements` ì„ íƒ
3. **Insert row** í´ë¦­
4. ë°ì´í„° ì…ë ¥:
   ```
   app_id: pocketchord
   title: ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸!
   content: ë²„ì „ 2.0ì´ ì¶œì‹œë˜ì—ˆìŠµë‹ˆë‹¤.
   is_active: true
   ```
   - `created_at`ì€ ìë™ ìƒì„±ë˜ë¯€ë¡œ ì…ë ¥ ë¶ˆí•„ìš”
5. **Save** â†’ ì•±ì—ì„œ ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥!

### ë°°ë„ˆ ê´‘ê³  ON/OFF


---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: Kotlin ë²„ì „ ë¶ˆì¼ì¹˜

**ì¦ìƒ**:
```
Module was compiled with an incompatible version of Kotlin.
The binary version of its metadata is 2.2.0
```

**í•´ê²°**: `libs.versions.toml`ì—ì„œ Kotlin ë²„ì „ì„ 2.2.21ë¡œ ì—…ê·¸ë ˆì´ë“œ

---

### ë¬¸ì œ 2: í…Œì´ë¸”ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ

**ì¦ìƒ**:
```
PostgrestRestException: Could not find the table 'public.xxx'
Code: PGRST205
```

**í•´ê²°**:
1. Supabase SQL Editorì—ì„œ í…Œì´ë¸” ì¡´ì¬ í™•ì¸
2. í…Œì´ë¸”ëª… ì˜¤íƒ€ í™•ì¸ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì•ˆ í•¨)
3. í…Œì´ë¸”ì´ ì—†ìœ¼ë©´ ìƒì„± (1ë‹¨ê³„ ì°¸ì¡°)

---

### ë¬¸ì œ 3: Row Level Security ì—ëŸ¬

**ì¦ìƒ**: ë°ì´í„°ê°€ ì•ˆ ë³´ì„

**í•´ê²°**:
```sql
-- ì„ì‹œ (ê°œë°œìš©)
ALTER TABLE your_table DISABLE ROW LEVEL SECURITY;

-- ìš´ì˜ìš©
CREATE POLICY "Enable read" ON your_table FOR SELECT USING (true);
```

---

### ë¬¸ì œ 4: ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬

**ì¦ìƒ**: `Unable to resolve host`

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `INTERNET` ê¶Œí•œ ì¶”ê°€í–ˆë‚˜?
- [ ] ì¸í„°ë„· ì—°ê²° í™•ì¸
- [ ] Supabase URLì´ ì •í™•í•œê°€?
- [ ] ì—ë®¬ë ˆì´í„°/ì‹¤ì œ ê¸°ê¸°ì—ì„œ í…ŒìŠ¤íŠ¸

---

### ë¬¸ì œ 5: ë°ì´í„°ê°€ ì¡°íšŒë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: ì¿¼ë¦¬ëŠ” ì„±ê³µí•˜ëŠ”ë° ê²°ê³¼ê°€ ë¹„ì–´ìˆìŒ

**ì›ì¸ 1: app_id í•„í„° ëˆ„ë½**
```kotlin
// âŒ ì˜ëª»ëœ ì½”ë“œ
supabase.from("announcements")
    .select()
    .eq("is_active", true)
    .decodeList<Announcement>()

// âœ… ì˜¬ë°”ë¥¸ ì½”ë“œ
supabase.from("announcements")
    .select()
    .eq("app_id", "pocketchord")  // ì¶”ê°€!
    .eq("is_active", true)
    .decodeList<Announcement>()
```

**ì›ì¸ 2: is_activeê°€ false**
- Supabase Dashboardì—ì„œ ë°ì´í„°ì˜ `is_active` ê°’ í™•ì¸

**ì›ì¸ 3: í…Œì´ë¸”ì´ ë¹„ì–´ìˆìŒ**
- SQL Editorì—ì„œ `SELECT * FROM announcements;` ì‹¤í–‰í•˜ì—¬ í™•ì¸

---

## FAQ

### Q: ì½”ë“œ ë°ì´í„°ë„ Supabaseì— ì €ì¥í•˜ë‚˜ìš”?

**A**: ì•„ë‹ˆìš”. ì½”ë“œ ë°ì´í„°ëŠ” ë¡œì»¬ Room DBì— ì €ì¥ë©ë‹ˆë‹¤. SupabaseëŠ” ê³µì§€ì‚¬í•­ ë“± ì„œë²„ ê´€ë¦¬ ì½˜í…ì¸ ë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### Q: @SerialNameì€ ì™œ í•„ìš”í•œê°€ìš”?

**A**: SupabaseëŠ” `snake_case` (ì˜ˆ: `is_active`)ë¥¼ ì‚¬ìš©í•˜ê³ , Kotlinì€ `camelCase` (ì˜ˆ: `isActive`)ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. `@SerialName`ìœ¼ë¡œ ìë™ ë³€í™˜ë©ë‹ˆë‹¤.

### Q: Anon Keyë¥¼ ì•±ì— ë„£ì–´ë„ ì•ˆì „í•œê°€ìš”?

**A**: ë„¤. Anon KeyëŠ” ê³µê°œ í‚¤ë¡œ, Row Level Securityë¡œ ë³´í˜¸ë©ë‹ˆë‹¤. ë‹¨, service_role í‚¤ëŠ” ì ˆëŒ€ ì•±ì— ë„£ìœ¼ë©´ ì•ˆ ë©ë‹ˆë‹¤!

### Q: ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ì•±ì„ ë‹¤ì‹œ ë¹Œë“œí•´ì•¼ í•˜ë‚˜ìš”?

**A**: ì•„ë‹ˆìš”. Supabase Dashboardì—ì„œ ë°ì´í„°ë§Œ ì¶”ê°€/ìˆ˜ì •í•˜ë©´ ì•±ì—ì„œ ì¦‰ì‹œ ì¡°íšŒë©ë‹ˆë‹¤.

### Q: ì˜¤í”„ë¼ì¸ì—ì„œë„ ì‘ë™í•˜ë‚˜ìš”?

**A**: ê¸°ë³¸ì ìœ¼ë¡œëŠ” ì˜¨ë¼ì¸ ì „ìš©ì…ë‹ˆë‹¤. ì˜¤í”„ë¼ì¸ ì§€ì›ì´ í•„ìš”í•˜ë©´ ìºì‹± ì „ëµ (7ë‹¨ê³„) ë˜ëŠ” Room DB ë™ê¸°í™”ë¥¼ êµ¬í˜„í•˜ì„¸ìš”.

### Q: app_idëŠ” ì™œ í•„ìš”í•œê°€ìš”?

**A**: í•˜ë‚˜ì˜ Supabase í”„ë¡œì íŠ¸ì—ì„œ ì—¬ëŸ¬ ì•±ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `app_id`ë¡œ ê° ì•±ì˜ ë°ì´í„°ë¥¼ êµ¬ë¶„í•©ë‹ˆë‹¤. ë°˜ë“œì‹œ ì¡°íšŒ ì‹œ `.eq("app_id", "pocketchord")`ë¡œ í•„í„°ë§í•´ì•¼ í•©ë‹ˆë‹¤!

### Q: created_atì€ ì–´ë–»ê²Œ í‘œì‹œí•˜ë‚˜ìš”?

**A**: ISO 8601 ë¬¸ìì—´ë¡œ ì €ì¥ë˜ë¯€ë¡œ ë³€í™˜ì´ í•„ìš”í•©ë‹ˆë‹¤:
```kotlin
fun formatDate(isoString: String?): String {
    if (isoString == null) return ""
    val instant = Instant.parse(isoString)
    val dateTime = instant.atZone(ZoneId.systemDefault())
    return dateTime.format(
        DateTimeFormatter.ofPattern("yyyyë…„ MMì›” ddì¼ HH:mm")
    )
}
// ì‚¬ìš©: Text(formatDate(announcement.createdAt))
```

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### Supabase ì„¤ì •
- [ ] Supabase í”„ë¡œì íŠ¸ ìƒì„±
- [ ] í…Œì´ë¸” ìƒì„± (announcements, app_versions)
- [ ] RLS ì •ì±… ì„¤ì •
- [ ] í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
- [ ] API í‚¤ í™•ì¸

### Android í”„ë¡œì íŠ¸
- [ ] Kotlin 2.2.21 ì´ìƒ
- [ ] kotlinx.serialization í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€
- [ ] Supabase/Ktor ì˜ì¡´ì„± ì¶”ê°€
- [ ] INTERNET ê¶Œí•œ ì¶”ê°€
- [ ] ë°ì´í„° ëª¨ë¸ ìƒì„±
- [ ] Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”

### í…ŒìŠ¤íŠ¸
- [ ] ì•± ì‹¤í–‰ ì‹œ ë°ì´í„° í‘œì‹œ í™•ì¸
- [ ] ì—ëŸ¬ ë¡œê·¸ í™•ì¸
- [ ] Dashboardì—ì„œ ë°ì´í„° ìˆ˜ì • â†’ ì•±ì—ì„œ í™•ì¸

---

## ë‹¤ìŒ ë‹¨ê³„

1. **ViewModel íŒ¨í„´ ì ìš©**: MVVM ì•„í‚¤í…ì²˜ë¡œ ë¦¬íŒ©í† ë§
2. **ì—ëŸ¬ í•¸ë“¤ë§ ê°œì„ **: Retry ë¡œì§, ì‚¬ìš©ì ì¹œí™”ì  ì—ëŸ¬ ë©”ì‹œì§€
3. **ì‹¤ì‹œê°„ êµ¬ë…**: Supabase Realtimeìœ¼ë¡œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
4. **ì˜¤í”„ë¼ì¸ ì§€ì›**: Room DB ë™ê¸°í™”
5. **Firebase Remote Config í†µí•©**: ì›ê²© ì„¤ì • ê´€ë¦¬

---

## ì°¸ê³  ìë£Œ

- [Supabase ê³µì‹ ë¬¸ì„œ](https://supabase.com/docs)
- [Supabase Kotlin SDK](https://supabase.com/docs/reference/kotlin)
- [kotlinx.serialization](https://github.com/Kotlin/kotlinx.serialization)
- [Ktor Client](https://ktor.io/docs/client.html)

---

**ë¬¸ì„œ ì‘ì„±**: GitHub Copilot  
**í”„ë¡œì íŠ¸**: PocketChord  
**ë²„ì „**: 1.0

