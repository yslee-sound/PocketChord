# Supabase 공지사항 효과적 운영 가이드

PocketChord 앱의 Supabase 공지사항 시스템을 효과적으로 운영하는 방법을 안내합니다.

**최종 업데이트**: 2025-11-05

---

## 📋 목차

1. [테이블 구조 및 필드 설명](#테이블-구조-및-필드-설명)
2. [운영 시나리오](#운영-시나리오)
3. [실전 예시](#실전-예시)
4. [베스트 프랙티스](#베스트-프랙티스)
5. [문제 해결](#문제-해결)

---

## 테이블 구조 및 필드 설명

### announcements 테이블

```sql
CREATE TABLE public.announcements (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    app_id TEXT NOT NULL,
    title TEXT NOT NULL,
    content TEXT NOT NULL,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    CONSTRAINT announcements_pkey PRIMARY KEY (id)
);
```

### 필드 상세 설명

| 필드 | 타입 | 설명 | 운영 팁 |
|------|------|------|---------|
| `id` | BIGINT | 고유 ID (자동 생성) | 수정 불가, 사용자는 이 값을 기준으로 "본 공지사항" 관리 |
| `created_at` | TIMESTAMP | 생성 시간 (자동) | 정렬 및 히스토리 관리에 활용 |
| `app_id` | TEXT | 앱 식별자 | **반드시** `"com.sweetapps.pocketchord"` 사용 |
| `title` | TEXT | 공지사항 제목 | **중앙 정렬**, 굵은 글씨, 24sp |
| `content` | TEXT | 공지사항 내용 | **좌측 정렬**, 일반 글씨, 16sp, 최대 300dp 스크롤 |
| `is_active` | BOOLEAN | 활성화 여부 | `true`만 앱에 표시됨 |

---

## 운영 시나리오

### 시나리오 1: 새 기능 출시 공지

**상황**: 앱에 새로운 기능이 추가됨

**목표**: 
- 사용자에게 새 기능 알림
- 긍정적인 첫인상 제공

**Supabase 설정**:
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '🎉 새로운 기능이 추가되었습니다!',
    '이제 PocketChord에서 더 많은 코드를 학습할 수 있습니다!

주요 업데이트:
• 200개 이상의 새로운 코드 추가
• 학습 진행도 추적 기능
• 즐겨찾기 기능 개선

지금 바로 확인해보세요!',
    true
);
```

**UI 표시**:
- ✅ 제목: "🎉 새로운 기능이 추가되었습니다!"
- ✅ 내용: 줄바꿈으로 구분된 명확한 설명
- ✅ 이모지 사용으로 시각적 강조
- ✅ X 버튼으로만 닫기

**운영 포인트**:
- 📌 이모지로 긍정적 분위기 조성
- 📌 명확한 혜택 나열
- 📌 간결하고 읽기 쉬운 문장

---

### 시나리오 2: 긴급 점검 안내

**상황**: 서버 점검으로 일시적 서비스 중단

**목표**:
- 사용자에게 사전 안내
- 불편 최소화

**Supabase 설정**:
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '⚠️ 서버 점검 안내',
    '더 나은 서비스 제공을 위한 서버 점검을 진행합니다.

📅 점검 일시: 2025년 11월 6일 (수) 02:00 ~ 04:00
⏱️ 소요 시간: 약 2시간
🔧 점검 내용: 서버 성능 개선

점검 시간 동안 일부 기능이 제한될 수 있습니다.
양해 부탁드립니다.

문의: support@sweetapps.com',
    true
);
```

**운영 포인트**:
- 📌 정확한 일시 명시
- 📌 소요 시간 안내
- 📌 연락처 제공
- 📌 점검 완료 후 `is_active = false`로 변경 필수!

**점검 완료 후**:
```sql
-- 점검 안내 비활성화
UPDATE announcements 
SET is_active = false 
WHERE id = 2;  -- 해당 공지사항 ID
```

---

### 시나리오 3: 이벤트 공지

**상황**: 기간 한정 이벤트 진행

**목표**:
- 참여 유도
- 긴박감 조성

**Supabase 설정**:
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '🎁 특별 이벤트 진행 중!',
    '앱 출시 1주년 감사 이벤트!

🎯 이벤트 기간
2025년 11월 5일 ~ 11월 12일 (7일간)

🎁 참여 방법
1. 앱 실행 후 "이벤트" 메뉴 클릭
2. 미션 완료하기
3. 푸짐한 보상 받기!

서두르세요! 
선착순 100명에게 특별 리워드 제공!',
    true
);
```

**이벤트 종료 후**:
```sql
-- 이벤트 공지 비활성화
UPDATE announcements 
SET is_active = false 
WHERE id = 3;

-- 또는 내용만 업데이트 (종료 안내)
UPDATE announcements
SET 
    title = '🎁 이벤트가 종료되었습니다',
    content = '많은 참여 감사드립니다!

당첨자 발표: 2025년 11월 15일
당첨자 확인: 앱 내 공지사항

다음 이벤트도 기대해주세요! 😊'
WHERE id = 3;
```

**운영 포인트**:
- 📌 명확한 기간 표시
- 📌 참여 방법 단계별 설명
- 📌 긴박감 조성 (선착순 등)
- 📌 **이벤트 종료 후 반드시 비활성화 또는 업데이트!**

---

### 시나리오 4: 중요 업데이트 권장

**상황**: 버그 수정 또는 보안 업데이트 필요

**목표**:
- 업데이트 유도
- 중요성 전달

**Supabase 설정**:
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '📱 업데이트 안내',
    '더 안정적인 앱 사용을 위해 최신 버전으로 업데이트해주세요.

✨ 주요 개선 사항
• 앱 안정성 향상
• 메모리 사용량 최적화
• UI/UX 개선
• 버그 수정

📲 업데이트 방법
Google Play 스토어에서 "업데이트" 버튼을 눌러주세요.

※ 이전 버전은 일부 기능이 제한될 수 있습니다.',
    true
);
```

**운영 포인트**:
- 📌 업데이트 이유 명확히 설명
- 📌 개선 사항 나열
- 📌 업데이트 방법 안내
- 📌 대부분 사용자가 업데이트 완료하면 비활성화

---

### 시나리오 5: 여러 공지사항 동시 관리

**상황**: 여러 개의 공지사항이 있을 때

**문제**: 앱은 최신 공지사항 1개만 표시

**해결 전략**:

#### 전략 1: 우선순위별 순차 공지
```sql
-- 1단계: 긴급 공지 (11월 5일)
INSERT INTO announcements (app_id, title, content, is_active)
VALUES ('com.sweetapps.pocketchord', '긴급 공지', '내용...', true);

-- 2단계: 11월 7일에 긴급 공지 비활성화 + 이벤트 공지 활성화
UPDATE announcements SET is_active = false WHERE id = 5;
INSERT INTO announcements (app_id, title, content, is_active)
VALUES ('com.sweetapps.pocketchord', '이벤트 공지', '내용...', true);
```

#### 전략 2: 통합 공지
```sql
-- 여러 내용을 하나의 공지로 통합
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '📢 중요 안내 사항',
    '안녕하세요, PocketChord 팀입니다.

1️⃣ 서버 점검 안내
• 일시: 11월 6일 02:00~04:00
• 내용: 성능 개선

2️⃣ 새 기능 추가
• 학습 진행도 추적
• 즐겨찾기 기능 개선

3️⃣ 이벤트 안내
• 기간: 11월 5일 ~ 12일
• 참여 방법: 앱 내 이벤트 메뉴

감사합니다!',
    true
);
```

**운영 포인트**:
- 📌 최신 공지사항만 표시됨을 인지
- 📌 긴급도에 따라 순차 공지
- 📌 또는 통합 공지로 여러 내용 전달

---

### 시나리오 6: 테스트 공지 (개발/스테이징)

**상황**: 프로덕션 배포 전 테스트 필요

**문제**: 
- Supabase는 프로덕션과 개발이 같은 데이터베이스를 공유
- 테스트 공지가 실제 사용자에게 보이면 안 됨

**해결**: app_id를 다르게 설정

#### 방법 1: 코드에서 app_id 변경 (권장)

**1단계: BuildConfig로 app_id 자동 전환**

`build.gradle.kts (app level)`:
```kotlin
android {
    buildTypes {
        debug {
            // 디버그 빌드용 app_id
            buildConfigField("String", "SUPABASE_APP_ID", "\"com.sweetapps.pocketchord.debug\"")
        }
        release {
            // 릴리즈 빌드용 app_id (실제 사용자)
            buildConfigField("String", "SUPABASE_APP_ID", "\"com.sweetapps.pocketchord\"")
        }
    }
}
```

**2단계: Repository에서 BuildConfig 사용**

`AnnouncementRepository.kt`:
```kotlin
class AnnouncementRepository(
    private val client: SupabaseClient,
    private val appId: String = BuildConfig.SUPABASE_APP_ID  // 자동으로 debug/release 구분
) {
    // ...
}
```

**3단계: Supabase에 테스트 데이터 추가**

```sql
-- 디버그 빌드용 (개발자만 보임)
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord.debug',  -- 디버그 app_id
    '🧪 테스트 공지',
    '이것은 테스트 공지입니다. 개발자만 볼 수 있습니다.',
    true
);

-- 프로덕션용 (실제 사용자가 봄)
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',  -- 실제 app_id
    '🎉 환영합니다!',
    '실제 사용자에게 표시되는 공지입니다.',
    true
);
```

**결과**:
- **디버그 빌드 실행**: "🧪 테스트 공지" 표시 ✅
- **릴리즈 빌드 실행**: "🎉 환영합니다!" 표시 ✅
- **실제 사용자**: "🎉 환영합니다!"만 보임 ✅

---

#### 방법 2: 수동으로 app_id 변경 (간단한 테스트용)

**테스트할 때만 임시로 변경**

`HomeScreen.kt`:
```kotlin
// 테스트 모드 (개발 중에만 사용)
val repository = AnnouncementRepository(
    supabase,
    "com.sweetapps.pocketchord.test"  // ← 임시로 .test 추가
)

// 프로덕션 (배포 전 원복)
val repository = AnnouncementRepository(
    supabase,
    "com.sweetapps.pocketchord"  // ← 원래대로
)
```

**Supabase 설정**:
```sql
-- 테스트용
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord.test',
    '테스트 중...',
    '이것은 테스트입니다.',
    true
);
```

**⚠️ 주의**: 배포 전 반드시 원래 app_id로 변경!

---

#### 방법 3: Supabase에서 여러 환경 관리

**app_id 네이밍 규칙**:
```
com.sweetapps.pocketchord           → 프로덕션 (실제 사용자)
com.sweetapps.pocketchord.debug     → 디버그 빌드
com.sweetapps.pocketchord.staging   → 스테이징 환경
com.sweetapps.pocketchord.test      → 개인 테스트
```

**Supabase 데이터**:
```sql
-- 프로덕션 공지
INSERT INTO announcements (app_id, title, content, is_active)
VALUES ('com.sweetapps.pocketchord', '실제 공지', '사용자에게 보임', true);

-- 디버그 공지
INSERT INTO announcements (app_id, title, content, is_active)
VALUES ('com.sweetapps.pocketchord.debug', '디버그 테스트', '개발자만 보임', true);

-- 스테이징 공지
INSERT INTO announcements (app_id, title, content, is_active)
VALUES ('com.sweetapps.pocketchord.staging', 'QA 테스트', 'QA팀만 보임', true);

-- 개인 테스트
INSERT INTO announcements (app_id, title, content, is_active)
VALUES ('com.sweetapps.pocketchord.test', '내 테스트', '나만 보임', true);
```

---

#### 방법 4: 사용자 ID 기반 테스트 (고급)

**특정 사용자에게만 테스트 공지 표시**

```sql
-- 테이블에 target_users 컬럼 추가 (선택사항)
ALTER TABLE announcements 
ADD COLUMN target_users TEXT[];

-- 특정 사용자만 볼 수 있는 공지
INSERT INTO announcements (app_id, title, content, is_active, target_users)
VALUES (
    'com.sweetapps.pocketchord',
    '🧪 베타 테스트',
    '선택된 사용자만 볼 수 있습니다.',
    true,
    ARRAY['user123@email.com', 'tester@email.com']  -- 특정 사용자만
);
```

---

### 운영 포인트

#### ✅ 권장 방법 (BuildConfig 사용)
```kotlin
// build.gradle.kts
buildTypes {
    debug {
        buildConfigField("String", "SUPABASE_APP_ID", 
            "\"com.sweetapps.pocketchord.debug\"")
    }
    release {
        buildConfigField("String", "SUPABASE_APP_ID", 
            "\"com.sweetapps.pocketchord\"")
    }
}

// Repository
val appId: String = BuildConfig.SUPABASE_APP_ID  // 자동 전환!
```

**장점**:
- ✅ 자동으로 환경 구분
- ✅ 배포 시 실수 방지
- ✅ 여러 환경 동시 관리 가능

#### ❌ 비권장 방법 (하드코딩)
```kotlin
// ❌ 위험: 배포 시 변경 깜빡할 수 있음
val appId = "com.sweetapps.pocketchord.test"
```

---

### 실전 예시: 새 공지사항 테스트 절차

**1단계: 테스트 공지 작성**
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord.debug',  -- 디버그 전용
    '🧪 [테스트] 새 기능 안내',
    '테스트 중인 공지사항입니다.

• 디자인 확인
• 문구 검토
• 길이 테스트

OK 확인 후 실제 공지로 교체',
    true
);
```

**2단계: 디버그 빌드로 확인**
```bash
# Android Studio에서 Debug 빌드 실행
# 또는
./gradlew installDebug
```

**3단계: 디자인/문구 확인**
- ✅ 제목이 적절한가?
- ✅ 내용이 잘 읽히는가?
- ✅ 이모지가 정상적으로 보이는가?
- ✅ 스크롤이 필요한가?
- ✅ X 버튼이 작동하는가?

**4단계: 실제 공지로 전환**
```sql
-- 테스트 공지 비활성화
UPDATE announcements 
SET is_active = false 
WHERE app_id = 'com.sweetapps.pocketchord.debug';

-- 실제 공지 등록
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',  -- 실제 app_id
    '🎉 새 기능 안내',
    '테스트를 통과한 실제 공지입니다.

• 확정된 디자인
• 검수 완료된 문구
• 최적화된 길이

지금 바로 확인하세요!',
    true
);
```

**5단계: 릴리즈 빌드로 최종 확인**
```bash
./gradlew installRelease
```

---

### 테스트 데이터 정리

**개발 완료 후 테스트 데이터 삭제**:
```sql
-- 테스트 공지 모두 삭제
DELETE FROM announcements 
WHERE app_id LIKE '%.debug' 
   OR app_id LIKE '%.test'
   OR app_id LIKE '%.staging';

-- 또는 비활성화만
UPDATE announcements 
SET is_active = false 
WHERE app_id LIKE '%.debug' 
   OR app_id LIKE '%.test';
```

---

### 요약

| 방법 | 장점 | 단점 | 추천도 |
|------|------|------|--------|
| **BuildConfig 사용** | 자동 전환, 안전 | 초기 설정 필요 | ⭐⭐⭐⭐⭐ |
| **수동 변경** | 간단함 | 배포 시 실수 위험 | ⭐⭐ |
| **환경별 분리** | 체계적 관리 | 복잡도 증가 | ⭐⭐⭐⭐ |
| **사용자 기반** | 세밀한 제어 | 구현 복잡 | ⭐⭐⭐ |

**결론**: **BuildConfig 방식을 권장합니다!** ✅

---

## 실전 예시

### 예시 1: 월간 정기 공지

**매월 1일 새 공지사항 등록**

```sql
-- 11월 공지
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '🗓️ 11월 업데이트 소식',
    '안녕하세요! 11월 업데이트 내용을 안내드립니다.

🆕 새로운 기능
• 메트로놈 기능 추가
• 튜너 정확도 개선

🐛 버그 수정
• 앱 크래시 문제 해결
• 코드 표시 오류 수정

📊 사용 통계
• 월간 활성 사용자: 10,000명
• 학습 완료율: 85%

항상 응원해주셔서 감사합니다! 💚',
    true
);

-- 월말에 비활성화
UPDATE announcements SET is_active = false WHERE id = 10;
```

**자동화 팁**:
- Supabase Functions로 자동 스케줄링 가능
- 월말 자동 비활성화 설정

---

### 예시 2: A/B 테스트용 공지

**다른 메시지 효과 비교**

```sql
-- 버전 A (간결한 메시지)
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '🎸 새 기능 추가!',
    '메트로놈과 튜너 기능이 추가되었습니다!',
    true
);

-- 며칠 후 버전 B로 교체 (상세한 메시지)
UPDATE announcements SET is_active = false WHERE id = 11;

INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '🎸 연습을 더욱 완벽하게!',
    '메트로놈과 튜너 기능으로 정확한 연습을 시작하세요!

🎵 메트로놈
• 40-240 BPM 조절
• 다양한 박자 지원

🎸 튜너
• 정확한 음정 측정
• 실시간 피드백

지금 바로 사용해보세요!',
    true
);
```

**분석**:
- 각 버전의 사용자 반응 모니터링
- 더 효과적인 메시지 스타일 파악

---

### 예시 3: 긴급 공지 + 후속 조치

**문제 발생 → 해결 → 사과**

```sql
-- 1단계: 긴급 공지 (문제 발생 시)
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '⚠️ 긴급 공지',
    '현재 일부 기능에 문제가 발생하여 조치 중입니다.

빠른 시일 내에 복구하겠습니다.
불편을 드려 죄송합니다.',
    true
);

-- 2단계: 해결 안내 (문제 해결 후)
UPDATE announcements SET is_active = false WHERE id = 15;

INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '✅ 문제 해결 완료',
    '이전에 발생한 문제가 모두 해결되었습니다.

정상적으로 서비스를 이용하실 수 있습니다.
불편을 드려 대단히 죄송합니다.

보상으로 모든 사용자에게 
특별 리워드를 지급해드렸습니다. 💝

감사합니다.',
    true
);
```

---

## 베스트 프랙티스

### ✅ DO (권장 사항)

#### 1. 명확하고 간결한 제목
```sql
-- ✅ 좋은 예
title = '🎉 새로운 기능 추가'
title = '⚠️ 점검 안내'
title = '🎁 이벤트 진행 중'

-- ❌ 나쁜 예
title = '안녕하세요 여러분'
title = '공지사항'
title = 'ㅎㅎㅎㅎㅎ'
```

#### 2. 구조화된 내용
```sql
-- ✅ 좋은 예
content = '주요 업데이트:
• 기능 1
• 기능 2
• 기능 3

자세한 내용은...'

-- ❌ 나쁜 예
content = '이번에 기능1이랑 기능2랑 기능3도 추가했어요 그리고...'
```

#### 3. 이모지 활용
```sql
-- 긍정적: 🎉 ✨ 💚 🎁 ⭐ 🎸
-- 경고: ⚠️ 🚨 ❗
-- 정보: 📢 📌 ℹ️ 💡
-- 날짜: 📅 🗓️
-- 시간: ⏰ ⏱️
```

#### 4. 기간 명시
```sql
-- ✅ 좋은 예
content = '이벤트 기간: 2025년 11월 5일 ~ 11월 12일'

-- ❌ 나쁜 예
content = '이벤트가 곧 끝나요~'
```

#### 5. 행동 유도 문구
```sql
-- ✅ 좋은 예
content = '지금 바로 확인해보세요!'
content = '앱을 업데이트해주세요.'
content = '이벤트 메뉴에서 참여하세요!'

-- ❌ 나쁜 예
content = '알아서 하세요.'
```

---

### ❌ DON'T (피해야 할 것)

#### 1. 너무 긴 내용
```sql
-- ❌ 나쁜 예 (스크롤 영역 300dp 초과)
content = '매우 긴 내용이 계속되고 계속되고...' (1000자 이상)

-- ✅ 개선
content = '요약 내용 제공
자세한 내용: [링크] 또는 앱 내 메뉴'
```

#### 2. 여러 공지사항 동시 활성화
```sql
-- ❌ 나쁜 예 (최신 것만 보임)
-- ID 10, 11, 12 모두 is_active = true

-- ✅ 개선: 하나만 활성화 또는 통합
-- ID 12만 is_active = true
-- 나머지는 false
```

#### 3. 오래된 공지 방치
```sql
-- ❌ 나쁜 예
-- 2개월 전 이벤트 공지가 계속 is_active = true

-- ✅ 개선: 정기적 정리
UPDATE announcements 
SET is_active = false 
WHERE created_at < NOW() - INTERVAL '1 month';
```

#### 4. 부적절한 app_id
```sql
-- ❌ 나쁜 예
app_id = 'pocketchord'
app_id = 'test'
app_id = 'com.example'

-- ✅ 올바른 예
app_id = 'com.sweetapps.pocketchord'
```

---

## 공지사항 라이프사이클 관리

### 표준 프로세스

```
1. 기획
   ↓
2. 작성 (Supabase INSERT)
   ↓
3. 활성화 (is_active = true)
   ↓
4. 모니터링 (사용자 반응 확인)
   ↓
5. 비활성화 (is_active = false)
   ↓
6. 보관 (삭제하지 않고 유지)
```

### SQL 템플릿

```sql
-- 1. 새 공지사항 등록
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '[제목]',
    '[내용]',
    true
);

-- 2. 특정 공지사항 비활성화
UPDATE announcements 
SET is_active = false 
WHERE id = [공지사항_ID];

-- 3. 모든 공지사항 비활성화 (긴급 시)
UPDATE announcements 
SET is_active = false 
WHERE app_id = 'com.sweetapps.pocketchord';

-- 4. 최신 공지사항 확인
SELECT * FROM announcements 
WHERE app_id = 'com.sweetapps.pocketchord' 
  AND is_active = true
ORDER BY created_at DESC 
LIMIT 1;

-- 5. 오래된 공지사항 정리
UPDATE announcements 
SET is_active = false 
WHERE app_id = 'com.sweetapps.pocketchord'
  AND created_at < NOW() - INTERVAL '30 days'
  AND is_active = true;

-- 6. 공지사항 히스토리 조회
SELECT id, title, created_at, is_active
FROM announcements
WHERE app_id = 'com.sweetapps.pocketchord'
ORDER BY created_at DESC;
```

---

## 문제 해결

### 문제 1: 공지사항이 표시되지 않음

**원인 체크리스트**:
```sql
-- 1. app_id 확인
SELECT * FROM announcements 
WHERE app_id = 'com.sweetapps.pocketchord';

-- 2. is_active 확인
SELECT * FROM announcements 
WHERE is_active = true;

-- 3. 최신 공지사항 확인
SELECT * FROM announcements 
WHERE app_id = 'com.sweetapps.pocketchord' 
  AND is_active = true
ORDER BY created_at DESC;

-- 4. RLS(Row Level Security) 정책 확인
-- Supabase Dashboard > Authentication > Policies
```

**해결**:
- app_id가 정확한지 확인
- is_active = true인지 확인
- RLS 정책에서 읽기 권한 허용

---

### 문제 2: 이미 본 공지사항이 계속 표시됨

**원인**: SharedPreferences 초기화 또는 ID 변경

**해결**:
```sql
-- 같은 내용이면 ID를 바꾸지 말고 UPDATE 사용
UPDATE announcements
SET 
    title = '[수정된 제목]',
    content = '[수정된 내용]'
WHERE id = [기존_ID];

-- 완전히 새 공지사항이면 이전 것 비활성화
UPDATE announcements SET is_active = false WHERE id = [이전_ID];
INSERT INTO announcements (...) VALUES (...);
```

---

### 문제 3: 공지사항이 너무 자주 바뀜

**원인**: 관리 프로세스 부재

**해결**:
```
1. 주간/월간 계획 수립
2. 공지사항 캘린더 작성
3. 중요도 분류 (긴급/일반/정보성)
4. 최소 3일 유지 권장
```

---

### 문제 4: 내용이 잘림

**원인**: 너무 긴 내용

**해결**:
```sql
-- ❌ 나쁜 예
content = '[5000자 이상의 긴 내용]'

-- ✅ 개선
content = '[요약 300자]

자세한 내용은 앱 내 공지사항 메뉴를 확인해주세요.'
```

---

## 모니터링 및 분석

### 유용한 SQL 쿼리

```sql
-- 1. 활성 공지사항 개수
SELECT COUNT(*) 
FROM announcements 
WHERE app_id = 'com.sweetapps.pocketchord' 
  AND is_active = true;

-- 2. 최근 7일간 생성된 공지사항
SELECT * 
FROM announcements 
WHERE app_id = 'com.sweetapps.pocketchord'
  AND created_at > NOW() - INTERVAL '7 days'
ORDER BY created_at DESC;

-- 3. 가장 오래된 활성 공지사항
SELECT * 
FROM announcements 
WHERE app_id = 'com.sweetapps.pocketchord'
  AND is_active = true
ORDER BY created_at ASC
LIMIT 1;

-- 4. 월별 공지사항 통계
SELECT 
    DATE_TRUNC('month', created_at) AS month,
    COUNT(*) AS total_announcements,
    SUM(CASE WHEN is_active THEN 1 ELSE 0 END) AS active_count
FROM announcements
WHERE app_id = 'com.sweetapps.pocketchord'
GROUP BY DATE_TRUNC('month', created_at)
ORDER BY month DESC;
```

---

## 체크리스트

### 공지사항 등록 전
- [ ] app_id가 `"com.sweetapps.pocketchord"`인가?
- [ ] 제목이 명확하고 간결한가?
- [ ] 내용이 300dp 이내로 읽기 쉬운가?
- [ ] 이모지가 적절히 사용되었는가?
- [ ] 기간이 명시되어 있는가? (해당 시)
- [ ] 맞춤법과 문법이 올바른가?
- [ ] is_active = true인가?

### 공지사항 활성화 후
- [ ] 실제 앱에서 정상 표시되는가?
- [ ] 제목이 중앙 정렬되는가?
- [ ] 내용이 좌측 정렬되는가?
- [ ] X 버튼이 작동하는가?
- [ ] 외부 클릭 시 닫히지 않는가?
- [ ] 백 버튼으로 닫히는가?

### 공지사항 종료 시
- [ ] is_active = false로 변경했는가?
- [ ] 새 공지사항을 준비했는가?
- [ ] 데이터를 백업했는가?

---

## 템플릿 모음

### 기본 템플릿
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '[제목]',
    '[내용]',
    true
);
```

### 이벤트 템플릿
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '🎁 [이벤트명]',
    '📅 기간: [시작일] ~ [종료일]
🎯 대상: [참여 대상]
🎁 보상: [보상 내용]

참여 방법:
1. [단계 1]
2. [단계 2]
3. [단계 3]

[추가 안내사항]',
    true
);
```

### 점검 안내 템플릿
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '⚠️ 서버 점검 안내',
    '📅 점검 일시: [날짜] [시작시간] ~ [종료시간]
⏱️ 소요 시간: 약 [시간]
🔧 점검 내용: [점검 사유]

점검 시간 동안 [영향 받는 기능]이/가 제한될 수 있습니다.

양해 부탁드립니다.
문의: [이메일]',
    true
);
```

### 업데이트 안내 템플릿
```sql
INSERT INTO announcements (app_id, title, content, is_active)
VALUES (
    'com.sweetapps.pocketchord',
    '📱 [버전] 업데이트',
    '✨ 주요 개선 사항
• [개선 1]
• [개선 2]
• [개선 3]

🐛 버그 수정
• [수정 1]
• [수정 2]

📲 업데이트 방법
Google Play 스토어 > PocketChord > 업데이트

[추가 안내]',
    true
);
```

---

## 요약

### 핵심 원칙

1. **명확성**: 제목과 내용을 명확하게
2. **간결성**: 300dp 이내로 작성
3. **일관성**: app_id 항상 확인
4. **시기적절성**: 적절한 시점에 활성화/비활성화
5. **모니터링**: 정기적으로 확인 및 정리

### 성공적인 운영을 위한 팁

- ✅ 주간/월간 공지사항 계획 수립
- ✅ 중요도에 따라 우선순위 관리
- ✅ 사용자 피드백 수집 및 반영
- ✅ A/B 테스트로 최적화
- ✅ 정기적인 데이터 정리

---

**공지사항은 사용자와의 중요한 소통 창구입니다.**  
효과적으로 활용하여 더 나은 사용자 경험을 제공하세요! 🎉

